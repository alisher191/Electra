import{h as A}from"./chunk-b247637b.js";import{b as y}from"./chunk-47a5e6ff.js";import{U as R}from"./chunk-be936bdc.js";import{n as f}from"./chunk-e33f88ff.js";import"./chunk-f868c71a.js";import{_ as C,U as F,al as P,aq as q,au as D,aD as N,i as g,B as G,r as v,o as d,c as u,b as I,w as k,f as w,g as l,a as r,n as h,F as H,d as L,e as O,p as M,h as W}from"./chunk-e8d35fff.js";const $={name:"AuthBlock",components:{UiButton:F,UiInput:P,UiSnackbar:R},props:{formType:{type:String,required:!0,validator(e){return["login","registration","reset-password","confirm-reset"].includes(e)}},inputs:{type:Array,default:()=>[]},submitBtnText:{type:String,default:"Default button text"},title:{type:String,default:"Default title text"},token:{type:String,default:""}},setup(e){const{t:n}=q(),{login:o}=A(),{meta:i}=D(),S=N(),T={email:{id:"email",value:"",placeholder:"E-mail",rules:"email|required"},password:{id:"password",value:"",placeholder:n("password"),type:"password",rules:"required"},"create-password":{id:"create-password",value:"",placeholder:n("password"),type:"password",rules:"required|min_length:8"},"repeat-password":{id:"repeat-password",value:"",placeholder:n("repeat_password"),type:"password",rules:"required|confirmed_password:@create-password"},ref:{id:"ref-id",value:"",placeholder:n("referal_id")},username:{id:"username",value:"",placeholder:n("username"),type:"text"}},m=g((()=>{const a=[];return e.inputs.forEach(c=>{const b=T[c];if(!b)throw Error(`There is no such input type "${c}" at initInputs method`);a.push(b)}),a})()),_=g(!1),s=g(!1),p=g(""),t=G(()=>m.value.reduce((a,c)=>(a[c.id]=c.value,a),{})),B=async()=>{try{_.value=!0;const{email:a,password:c}=t.value;await o(a,c),await f("/")}catch(a){a.response.status===401?p.value=n("bad_credentials"):p.value=n("unknown_error"),s.value=!0,console.error("login failed",a)}finally{_.value=!1}},E=async()=>{await y.AUTH.REGISTER({username:t.value.username||t.value.email,email:t.value.email,password:t.value["create-password"],password2:t.value["repeat-password"],ref:t.value["ref-id"]||""}).then(async()=>{f("/registration/email-confirmation"),console.log(t),await o(t.value.email,t.value["repeat-password"])}).catch(a=>{console.log(a)})},V=async()=>{await y.USER.REQUEST_PASSWORD_CHANGE(t.value.email).then(()=>{f("/reset-password/confirm-reset")}).catch(a=>{console.log(a)})},x=async()=>{await y.USER.CONFIRM_PASSWORD_CHANGE(e.token,t.value["repeat-password"]).then(()=>{f(S("/login"))}).catch(a=>{console.log(a)})};return{formedInputs:m,authInProcess:_,authFailed:s,errorText:p,formValues:t,handleSubmit:()=>e.formType==="login"?B():e.formType==="registration"?E():e.formType==="reset-password"?V():e.formType==="confirm-reset"?x():"",meta:i}}},Q=e=>(M("data-v-572cf165"),e=e(),W(),e),j={class:"container"},z=["href"],J=Q(()=>r("img",{class:"auth__logo",src:"/icons/logos/alfabit-exchange.svg",alt:"logo",draggable:"false"},null,-1)),K=[J],X={class:"auth__title"},Y={key:0,class:"auth__reset-password-tip"},Z={class:"auth__form"},ee=["href"],ae={class:"auth__form__input__extra"},te={key:1,class:"auth__extra"},se=["href"],oe={class:"auth__extra__link"},re={key:2,class:"auth__extra"},ne=["href"],le={class:"auth__extra__link"},ie={key:3,class:"auth__extra"},de=["href"],ce={class:"auth__extra__link"};function ue(e,n,o,i,S,T){const U=v("UiSnackbar"),m=v("UiInput"),_=v("UiButton");return d(),u("div",j,[I(U,{modelValue:i.authFailed,"onUpdate:modelValue":n[0]||(n[0]=s=>i.authFailed=s),type:"error"},{content:k(()=>[w(l(i.errorText),1)]),_:1},8,["modelValue"]),r("a",{href:e.$path("/")},K,8,z),r("h1",X,l(o.title),1),o.formType==="reset-password"?(d(),u("div",Y,l(e.$t("reset_password_tip")),1)):h("",!0),r("form",Z,[(d(!0),u(H,null,L(i.formedInputs,(s,p)=>(d(),O(m,{id:s.id,key:p,modelValue:s.value,"onUpdate:modelValue":t=>s.value=t,class:"auth__form__input",placeholder:s.placeholder,rules:s.rules,"native-type":s.type},{extra:k(()=>[o.formType==="login"&&s.id==="password"?(d(),u("a",{key:0,href:e.$path("/reset-password")},[r("span",ae,l(e.$t("forgot_password")),1)],8,ee)):h("",!0)]),_:2},1032,["id","modelValue","onUpdate:modelValue","placeholder","rules","native-type"]))),128)),I(_,{class:"auth__form__btn",loading:i.authInProcess,disabled:!i.meta.valid,onClick:i.handleSubmit},{default:k(()=>[w(l(o.submitBtnText),1)]),_:1},8,["loading","disabled","onClick"])]),o.formType==="login"?(d(),u("p",te,[w(l(e.$t("no_account"))+" ",1),r("a",{href:e.$path("/registration")},[r("span",oe,l(e.$t("register")),1)],8,se)])):h("",!0),o.formType==="registration"?(d(),u("p",re,[w(l(e.$t("already_have_an_account"))+" ",1),r("a",{href:e.$path("/login")},[r("span",le,l(e.$t("log_in")),1)],8,ne)])):h("",!0),o.formType==="reset-password"||o.formType==="confirm-reset"?(d(),u("p",ie,[r("a",{href:e.$path("/login")},[r("span",ce,l(e.$t("back_to_login")),1)],8,de)])):h("",!0)])}const ye=C($,[["render",ue],["__scopeId","data-v-572cf165"]]);export{ye as A};
